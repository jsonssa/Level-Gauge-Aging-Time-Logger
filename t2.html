<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <style>
        form{
            margin: 30px auto;
            width: 35%;
        }
    </style>
</head>
<body>
<form action="">
    <fieldset>
        <legend>http控制</legend>
        <br>
        <br>
        <div id="httpCtrol">
            <input type="button" sy-val = '01050000FF008C3A' value="打开1号继电器">
            <input type="button" sy-val = '010500000000CDCA' value="关闭1号继电器">
            <input type="button" sy-val = '01050001FF00DDFA' value="打开2号继电器">
            <input type="button" sy-val = '0105000100009C0A' value="关闭2号继电器">
            <input type="button" sy-val = '010500000000CDCA,0105000100009C0A' value="关闭所有">
        </div>
    </fieldset>
</form>
<br>
<form class="form">
    <fieldset>
        <legend>websocket 控制</legend>
        <br>
        <br>
        <div>
            <input type="button" onclick="clickDend('010500000000CDCA,0105000100009C0A')" value="关闭所有">
            <input type="button" onclick="clickDend('010500000000CDCA,0105000100009C0A')" value="关闭所有">
        </div>
        <br>
        <ul id="content"></ul>
        <input type="text" placeholder="请输入发送的消息" class="message" id="message"/>
        <input type="button" value="发送" id="send" class="connect"/>
        <input type="button" value="连接" id="connect" class="connect"/>
    </fieldset>
</form>
<div class="row">
    <div class="col-md-6 col-md-push-3">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <td>继电器序号</td><td>继电器状态</td><td>继电器激活时间</td><td>继电器关闭时间</td><td>开启</td><td>关闭</td><td>持续时间</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>001</td><td id="jxd001">未知</td><td id="timestart001">未知</td><td id="timeend001">未知</td><td><input type="button" onclick="clickDend('01050000FF008C3A')" value="打开"></td><td><input type="button" onclick="clickDend('010500000000CDCA')" value="关闭"></td><td id="sjz001"></td>
                </tr>
                <tr>
                    <td>002</td><td id="jxd002">未知</td><td id="timestart002">未知</td><td id="timeend002">未知</td><td><input type="button" onclick="clickDend('01050001FF00DDFA')" value="打开"></td><td><input type="button" onclick="clickDend('0105000100009C0A')" value="关闭"></td><td id="sjz002"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="js/jquery.min.js"></script>

<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="js/bootstrap.min.js"></script>
<script>
 function getTimeDifference(time1, time2) {
  var date1 = new Date(time1); // time1为字符串形式的时间
  var date2 = new Date(time2); // time2为字符串形式的时间
  var difference = date2.getTime() - date1.getTime(); // 计算两个时间戳的差值
 
  // 转换为小时、分钟和秒
  var hours = Math.floor(difference / (1000 * 60 * 60));
  var minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((difference % (1000 * 60)) / 1000);
 
  return hours + "小时 " + minutes + "分钟 " + seconds + "秒";
}
    var oUl=document.getElementById('content');
    var oConnect=document.getElementById('connect');
    var oSend=document.getElementById('send');
    var oInput=document.getElementById('message');
    var Jdq001=document.getElementById('jxd001');
    var timestart001=document.getElementById('timestart001');
    var timeend001 = document.getElementById('timeend001');
    var sjz001 = document.getElementById('sjz001');

    var Jdq002=document.getElementById('jxd002');
    var timestart002=document.getElementById('timestart002');
    var timeend002 = document.getElementById('timeend002');
    var sjz002 = document.getElementById('sjz002');
    var ws=null;
    oConnect.onclick=function(){
        ws=new WebSocket('ws://localhost:5000');
        ws.onopen=function(){
            oUl.innerHTML+="<li>客户端已连接</li>";
        }
        ws.onmessage=function(evt){
            if(evt.data=='01050000FF008C3A'){
                timestart001.innerText = `${new Date().toLocaleString()}`;
                Jdq001.innerText = '激活继电器';
            }
            if(evt.data=='010500000000CDCA'){
                timeend001.innerText = `${new Date().toLocaleString()}`;
                Jdq001.innerText = '关闭继电器';
                var res = getTimeDifference(timestart001.innerText,timeend001.innerText);
                sjz001.innerText = res;
            }
            if(evt.data=='01050001FF00DDFA'){
                timestart002.innerText = `${new Date().toLocaleString()}`;
                Jdq002.innerText = '激活继电器';
            }
            if(evt.data=='0105000100009C0A'){
                timeend002.innerText = `${new Date().toLocaleString()}`;
                Jdq002.innerText = '关闭继电器';
                var res = getTimeDifference(timestart002.innerText,timeend002.innerText);
                sjz002.innerText = res;
            }
        }
        ws.onclose=function(){
            oUl.innerHTML+="<li>客户端已断开连接</li>";
        };
        ws.onerror=function(evt){
            oUl.innerHTML+="<li>"+evt.data+"</li>";

        };
    };
    oSend.onclick=function(){
        if(ws){
            ws.send(oInput.value);
        }
    }
    function clickDend(val){
        // console.log(val)
        if(ws){
//          ws.send('010500000000CDCA,0105000100009C0A,0105000200006C0A,0105000300003DCA');
            ws.send(val);
        }
    }
</script>
<script>
    $(function () {
        $('#httpCtrol input').on('click',function () {
            var $this = $(this)
            $.ajax({
                method:'post',
                url:'http://localhost:1124/ledControl/on.do',
                data:{data:$this.attr('sy-val')},
                success:function (res) {
                    console.log(res)
                }
            })
        })
    })
</script>
</body>
</html>